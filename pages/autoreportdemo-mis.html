<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>易车AutoReport</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- <script src='https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js'></script> -->
    <!-- <script src='../js/jquery.min.js'></script> -->
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/bootstrap-datetimepicker.min.css">
    <script src="../js/bootstrap-datetimepicker.min.js"></script>
    <script src="../js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script type="text/javascript" src="../js/dateRange.js"></script>
    <link rel="stylesheet" type"text/css" href="../css/dateRange.css"/>
    <link rel="stylesheet" href="../css/report.css"> 
</head>


<body>
    <div class="wrapper">
        <div class="content">
            <div class="col-md-12">
                <div class="box box-danger">
                    <div class="box-body">
            
            
            
                        <form class="form-inline report-form">
                            <div class="form-group type-group">
                                <label for="carTypeRadios">请选择报表类型:</label>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="reportTypeRadios" id="carTypeReport" value="carTypeReport" checked /> 
                                        <span>车型页面数据报表</span>
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="reportTypeRadios" id="channelTypeReport" value="channelTypeReport" />
                                        <span>栏目页面数据报表</span>
                                    </label>
                                </div>
                            </div>

                        </form>
                        <form class="form-inline report-form form-detail">
                            <div class="form-group time-group">
                                <label for="report-date">请选择报表时间:</label>

                                <div class="ta_date" id="div_date1">
                                    <span class="date_title" id="date1">2012-06-13 至 2012-07-19</span>
                                    <a class="opt_sel" id="input_trigger1" href="#">
                                    <i class="i_orderd"></i>
                                    </a>
                                </div>
                                
                            </div>
                            
                            <div class="form-group content-group">
                                <label for="carTypeRadios ">报表内容定制:</label>
                                <a class="btn btn-primary drop-panel-btn channel-select" style="display: none;">
                                    <span>栏目选择</span>
                                    <div class="drop-panel ">
                                        <div class="group">
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" name="channel-select-top" id="select-all " value="selectAll" class="selectAll" /><span>全选</span>
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" name="channel-select-top" id="select-conclusion" value="selectConclusion" class="selectConclusion"/><span>全站汇总</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="group group-column">
                                            <span class="title ">栏目</span>
                                            <ul>
                                        
                                            </ul>
                                        </div>
                                        <div class="group group-pages">
                                            <span class="title">页面</span>
                                            <ul>
                                               
                                            </ul>
                                        </div>
                                        <div class="group group-btn">
                                            <input type="button" class="btn btn-default panel-cancel" value="取消">
                                            <input type="button" class="btn btn-primary panel-confirm" data-name="channel-btn" value="确认">
                                        </div>
                                    </div>
                                </a>
                                <a class="btn btn-primary drop-panel-btn car-page-select">
                                    <span>车型页面选择</span>
                                    <div class="drop-panel ">
                                        <div class="group group-radio">
                                           
                                        </div>
                                        <div class="group group-btn">
                                            <input type="button" class="btn btn-default panel-cancel" value="取消">
                                            <input type="button" class="btn btn-primary panel-confirm" data-name="carpage-btn" value="确认">
                                        </div>
                                    </div>
                                </a>
                                <a class="btn btn-primary drop-panel-btn car-select">
                                    <span>车型选择</span>
                                    <div class="drop-panel ">
                                        <div class="group search-group">
                                             <input type="text" placeholder="请搜索车型" class="search-input">
                                             <ul class="search-list">
                                               <!--  <ul>
                                                     <li class="firm">一汽大众</li>
                                                     <li data-value='span' class="detail">span</li>
                                                     <li data-value='td' class="detail">腾达</li>
                                                     <li data-value='ad' class="detail">奥迪</li>
                                                     <li data-value='pc' class="detail">奔驰</li>
                                                </ul> -->
                                                 
                                             </ul>
                                        </div>
                                        <div class="group">
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" name="cartype-select-radio" id="select-all " class="selectAll" value='allcars'/><span>全部车型</span>
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" name="cartype-select-radio" id="select-conclusion" value="selectConclusion" /><span>汇总</span>
                                                </label>
                                            </div>
                                            
                                        </div> 
                                        <div class="group">
                                            <label class="selected-label">已选</label>
                                            <ul class="selected-tabs">
                                                <!-- <li><span>路虎</span><a>x</a></li> -->
                                                <!-- <li><span class="delete-content">腾达</span><span class="delete-icon">x</span></li> -->
                                            </ul>
                                        </div>
                                        <div class="group group-btn">
                                            <input type="button" class="btn btn-default panel-cancel" value="取消">
                                            <input type="button" class="btn btn-primary panel-confirm" data-name="cartype-btn" value="确认">
                                        </div>
                                    </div>
                                </a>
                                <a class="btn btn-primary drop-panel-btn area-select">
                                    <span>区域选择</span>
                                    <div class="drop-panel ">
                                        <div class="group">
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" name="channel-select-top" id="select-all " value="selectAll" class="selectAll"/><span>全选</span>
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" name="channel-select-top" id="selectConclusion" value="selectConclusion" class="selectConclusion" /><span>汇总</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="group group-area">
                                            <ul>
                                                <!-- <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="area" value="bj"><span>北京</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="area" value="ln"><span>辽宁</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="area" class="sh"><span>上海</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="area" value="sichuan"><span>四川</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="area" value="anhui"><span>安徽</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="area" value="hubei"><span>湖北</span></label>
                                                    </div>
                                                </li> -->
                                            </ul>
                                        </div>
                                        <div class="group group-btn">
                                            <input type="button" class="btn btn-default panel-cancel" value="取消">
                                            <input type="button" class="btn btn-primary panel-confirm" data-name="area-btn"value="确认">
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="form-group quota-group ">
                                <label for="carTypeRadios ">报表指标定制:</label>
                                <a class="btn btn-primary drop-panel-btn quota-select">
                                    <span>指标选择</span>
                                    <div class="drop-panel ">
                                        <div class="group">
                                            <div class="radio">
                                                <label>
                                                    <input type="radio" name="cartype" id="select-all " value="selectAll" class="selectAll"/>全选
                                                </label>
                                            </div>
                                        </div>
                                        <div class="group group-quota">
                                         <ul>
                                               <!--  <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" class="selectAll"><span>全选</span></label>
                                                    </div>
                                                </li> -->
                                               <!--  <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="quota" value="pv"><span>pv</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="quota" value="uv"><span>uv</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="checkbox">
                                                        <label>
                                                            <input type="checkbox" name="quota" value="avg_time"><span>平均访问时长</span></label>
                                                    </div>
                                                </li> -->
                                            </ul>
                                       
                                            
                                        </div>
                                           
                                        <div class="group group-btn">
                                            <input type="button" class="btn btn-default panel-cancel" value="取消">
                                            <input type="button" class="btn btn-primary panel-confirm" data-name="quota-btn" value="确认">
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="form-group ">
                                <input type="button" class="btn btn-warning generate-report" value="生成报表">
                            </div>
                        </form>
                        <div class="report-show">
                            <ul class="report-show-list">
                                <!-- <li>
                                    <span class="title">2017-07-07车型页面报表</span>
                                    <a class="preview">预览</a>
                                    <a class="download">下载</a>
                                </li>
                                <li>
                                    <a class="download-all">下载全部</a>
                                </li>  -->
                            </ul>
                            <hr class="devider devider-dotted">
                            <div class="report-preview">
                                <span class="title">报表预览</span>
                                <div class="preview-table">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-report table-bordered">
                                            <!-- <thead>
                                                <tr>
                                                    <th >页面名称</th>
                                                    <th >日期</th>
                                                    <th >车型</th>
                                                    <th >省份</th>
                                                    <th >pv</th>
                                                    <th>uv</th>
                                                    <th >平均访问时长</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row" >报表结果搜索页</th>
                                                    <td>2017.07.07-2017.07.10</td>
                                                    <td>suv</td>
                                                    <td>北京</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" >单一车型</th>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" >单一车型-综述页</th>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" >单一车型-图片</th>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" >单一车型-参数</th>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" >单一车型-视频</th>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" >单一车型图片浏览页</th>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" >单一车型论坛页</th>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </tbody> -->
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src='../components/header/header.js'></script>
<script src='../components/sidebar/sidebar.js'></script>
<script>

$('.wrapper').on('click',function(){
    $('.drop-panel').hide();
})
var result = {},//最终变量
    reportType = [],
    column = [],
    page = [],
    carpage = [],
    cartype = [],
    area = [],
    metric = [],
    timeInterval={};
    reportType.push({
        name:$('input[name=reportTypeRadios]:checked').siblings('span').html(),
        id:$('input[name=reportTypeRadios]:checked').val()
    })

//获取所有数据

$.ajax({
    url:'http://172.20.33.72:8863/testpc/api/getAllMapping',
    type:'get',
    success:function(data){
        alert('success')
        console.log(data);

    },
    error:function(error){
        console.log(error)
    }
});

$.getJSON("http://172.20.33.72:8863/testpc/api/getAllMapping",function(data){
    alert(1);
    console.log(data);
    var result = data.result;
    var data = result.data;
    var channel = data.channel;
    var carpage = data.carpage;
    var area = data.area;
    var metric = data.metric;
    var column = data.column;
    var page = data.page;
    totalCarNumber = data.totalCarNumber;
    // console.log(totalCarNumber)


    // $.each(channel,function(index,item){
    //     var channelArr = [
    //         '<div class="group">',
    //             '<span class="title ">'+item.name+'</span>',
    //             '<ul name='+item.id+'></ul>',
    //         '</div>'
    //     ]
    //     $('a.channel-select').find('.group-btn').before(channelArr.join(''))
    //     var f_id = item.id;
    //     $.each(item.children,function(index,item){
    //         var liArr = [
    //             '<li>',
    //                 '<div class="checkbox">',
    //                 '<label>',
    //                     '<input type="checkbox" value='+item.id+' name='+f_id+'><span>'+item.name+'</span>',
    //                 '</label>',
    //                 '</div>',
    //             '</li>'
    //         ]
    //         $('ul[name='+f_id+']').append(liArr.join(''));
    //     })
    // })


$.each(column,function(index,item){

    var columnStr = [
        '<li>',
            '<div class="checkbox">',
                '<label>',
                    '<input type="checkbox" name="column" value="'+item.id+'"><span>'+item.name+'</span>',
                '</label>',
            '</div>',
        '</li>'
    ]

    $('.channel-select .group-column ul').append(columnStr.join(''));

})

$.each(page,function(index,item){

    var pageStr = [
        '<li>',
            '<div class="checkbox">',
                '<label>',
                    '<input type="checkbox" name="page" value="'+item.id+'"><span>'+item.name+'</span>',
                '</label>',
            '</div>',
        '</li>'
    ]

    $('.channel-select .group-pages ul').append(pageStr.join(''));

})
$.each(carpage,function(index,item){

        var carPageStr = [
            '<div class="radio">',
                '<label>',
                    '<input type="radio" name="carpage" value="'+item.id+'" /><span>'+item.name+'</span>',
                '</label>',
            '</div>'
        ]

        $('.car-page-select .group-radio').append(carPageStr.join(''));

})

$.each(area,function(index,item){

    var areaStr = [
        '<li>',
            '<div class="checkbox">',
                '<label>',
                    '<input type="checkbox" name="area" value="'+item.id+'"><span>'+item.name+'</span>',
                '</label>',
            '</div>',
        '</li>'
    ]

    $('.area-select .group-area ul').append(areaStr.join(''));

})

$.each(metric,function(index,item){
        

    var metricStr = [
        '<li>',
            '<div class="checkbox">',
                '<label>',
                    '<input type="checkbox" name="quota" value="'+item.id+'"><span>'+item.name+'</span>',
                '</label>',
            '</div>',
        '</li>'
    ]

    $('.quota-select .group-quota ul').append(metricStr.join(''));

    })


})

//请选择报表类型的业务逻辑处理
$('input[name=reportTypeRadios]').on('change',function(){
    $('.form-detail')[0].reset();
    column = [],
    page = [],
    carpage = [],
    cartype = [],
    area = [],
    metric = [],
    reportType = [];

    var reportTypeResult = $('input[name=reportTypeRadios]:checked').val();
    if((reportTypeResult) == 'carTypeReport'){
        $('.channel-select').hide();
        $('.car-page-select, .car-select').show();
    }
    else if((reportTypeResult) == 'channelTypeReport'){
     
        $('.car-page-select, .car-select').hide();
        $('.channel-select').show();
    }
    else{
        $('.channel-select').show();
        $('.car-page-select, .car-select').show();
    }
    reportType.push({
        name:$(this).parent().find('span').html(),
        id:$(this).val()
    })
    console.log("reportType",reportType)
})

$('.group-btn .panel-confirm').on('click',function(){
    var btnName = $(this).data('name').split('-')[0];
    switch(btnName){
        case "area":{
            area = [];
            
            var radioValue = $(this).parents('.drop-panel').find('input[type=radio]:checked').siblings('span').html();
            if(radioValue&&radioValue.indexOf('汇总')>-1){
                area.push({
                    name:'汇总',
                    id:'999'
                })
            }
            else if(radioValue&&radioValue.indexOf('全选')>-1){
                area.push({
                    name:"total",
                    id:"total"
                })
            }
            else{
                $(this).parents('.drop-panel').find('.checkbox input[name=area]:checked').each(function(){
                    area.push({
                        name:$(this).siblings('span').html(),
                        id:$(this).val()
                    })
                })
            }
            
            if(area.length == 0){
                alert('未选择区域');
                return;
            }
            
            console.log("area",area);
            $(this).parents('.drop-panel').hide();
            break;
        };
        case "channel":{
            column = [];
            page = [];
            var radioValue = $(this).parents('.drop-panel').find('input[type=radio]:checked').siblings('span').html();
            if(radioValue&&radioValue.indexOf('汇总')>-1){
                column.push({
                    name:'汇总',
                    id:'999'
                });
                page.push({
                    name:'汇总',
                    id:'999'
                })
            }
            else if(radioValue&&radioValue.indexOf('全选')>-1){
                column.push({
                    name:'total',
                    id:'total'
                });
                page.push({
                    name:'total',
                    id:'total'
                })
            }
            else{
                    $(this).parents('.drop-panel').find('.checkbox input[name=column]:checked').each(function(){
                    column.push({
                        name:$(this).parent().find('span').html(),
                        id:$(this).val()
                    });
                })

                    $(this).parents('.drop-panel').find('.checkbox input[name=page]:checked').each(function(){
                    page.push({
                        name:$(this).parent().find('span').html(),
                        id:$(this).val()
                    });
                })
            }
            if(column.length == 0&&page.length ==0){
                alert('未选择栏目！');
                return;
            }
            console.log("column",column);
            console.log("page",page);
            $(this).parents('.drop-panel').hide();
            break;

        };
        case "cartype":{
            cartype = [];
            var radioValue = $(this).parents('.drop-panel').find('input[type=radio]:checked').siblings('span').html();
            if(radioValue&&radioValue.indexOf('全部')>-1){
                cartype.push({
                    name:'total',
                    id:"total"
                })
            }
            else if(radioValue&&radioValue.indexOf('汇总')>-1){

                cartype.push({
                    name:'汇总',
                    id:999
                })

            }
            else{
                $(this).parents('.drop-panel').find('.selected-tabs li').each(function(){
                    cartype.push({
                        name:$(this).find('.delete-content').html(),
                        id:$(this).find('.delete-content').data('value')
                    })
                })

            }
            if(cartype.length==0){
                alert('未选择车型！')
                return;
            }
            console.log("cartype",cartype)
            $(this).parents('.drop-panel').hide();
            break;

        };
        case "carpage":{
            carpage = [];
            var radioName = $(this).parents('.drop-panel').find('input[type=radio]:checked').siblings('span').html();
            var radioValue = $(this).parents('.drop-panel').find('input[type=radio]:checked').val()
            if(!radioValue){
                alert('未选择车型页面!');
                return;
            }
            carpage.push({
                name:radioName,
                id:radioValue
            })
            console.log("carpage",carpage);
            $(this).parents('.drop-panel').hide();

            break;

        };
        case "quota":{
            metric = [];
            var radioValue = $(this).parents('.drop-panel').find('input[type=radio]:checked').val();
            if(radioValue&&radioValue.indexOf('selectAll')>-1){
                metric.push({
                    name:'total',
                    id:'total'
                })
            }
            else{
                $(this).parents('.drop-panel').find('.checkbox input[name=quota]:checked').each(function(){
                    metric.push({
                        name:$(this).parent().find('span').html(),
                        id:$(this).val()
                    })
                })
            }
            if(metric.length==0){
                alert('未选择报表指标')
                return;
            }
            console.log('metric',metric)

            
           
            $(this).parents('.drop-panel').hide();

            break;

        }
        default:break;
    }
    
})


//点击checkbox的时候去掉radio的选择
$('.group').on('click','input[type=checkbox]',function(){
     $(this).parents('.drop-panel').find('.radio input').prop('checked',false);
})


$('.group').on('change','.radio input',function(){
    var radioValue = $(this).val();
    if(radioValue=='selectAll'){
        $(this).parents('.drop-panel').find('.checkbox input').prop("checked", true);
        console.log($(this).parents('.drop-panel').find('.checkbox input'));
    }
    else if(radioValue=='selectConclusion'){
        $(this).parents('.drop-panel').find('.checkbox input').removeAttr("checked");
    }
    else if(radioValue =='allcars'){
        
    }

})

$('.radio input[name=cartype-select-radio]').on('change',function(){
    var radioValue = $(this).val();
    if(radioValue=='allcars'){
        $(this).parents('.drop-panel').find('.selected-tabs li').remove();
        $(this).parents('.drop-panel').find('.search-input').val('全部'+totalCarNumber+'款车型')
        var tabStr = '<li><span class="delete-content all-cars">'+'全部'+totalCarNumber+'款车型</span><span class="delete-icon">x</span></li>'
        $(this).parents('.drop-panel').find('.selected-tabs').append(tabStr);
    }
    else{
         $(this).parents('.drop-panel').find('.selected-tabs li').remove();
         $(this).parents('.drop-panel').find('.search-input').val('')
    }

})





//设置下拉面板的高度和定位
var dropPanelBtnHeight = $('.drop-panel-btn').outerHeight();
$('.drop-panel').css('top', dropPanelBtnHeight + 2);


//点击btn显示面板
$('.drop-panel-btn').on('click', function(e) {
    $(this).parents('.content').find('.drop-panel').hide();
    $(this).find('.drop-panel').toggle();
    e.stopPropagation();

})

//停止drop-panel的点击影响父元素
$('.drop-panel').on('click', function(e) {
    e.stopPropagation();
})

//点击面板上的取消按钮
$('.panel-cancel').on('click', function() {
    $(this).parent().parent().hide();
})


//配置上方菜单栏
$('.content').headerPlugin({
    systemName: '易车 Auto Report PC平台',
    showUser:true,
    userid:93109
});

//配置左侧菜单栏
$('.content').sidebarPlugin({
    defaultIcon: 'glyphicon glyphicon-list-alt',
    menu: [{
        'menu-name': '报表展示',
        'url': '#'
    }]

});


//点击生成报表
$('.generate-report').on('click', function() {
    result = {};
    result.timeInterval = timeInterval;
    result.area = area;
    result.metric = metric;
    console.log(reportType)
    
    if(reportType[0].id=='carTypeReport'){
        result.type = 1;
        result.carpage = carpage;
        result.cartype = cartype;  
    }
    else
    {
        result.type = 2;
        result.column = column;
        result.page = page;
        $('.report-show-list').html('')
        $('.table-report').html('')
        $('.report-preview').hide();
        $('.report-show-list').append('暂无数据');

        $('.report-show').show();
        return;
       
    }
     
    console.log(result);
    $.getJSON('../mockdata/report-show-demo.json',function(data){
        $('.report-show-list').html('');
        var reportInfo = data.result.data.reports;
        $.each(reportInfo,function(index,item){
            var resportStr = [
                '<li>',
                    '<span class="title">'+item.name+'</span>',
                    '<a class="preview"> 预览 </a>',
                    '<a class="download" href="'+item.url+'"> 下载 </a>',
                '</li>'
            ]

            $('.report-show-list').append(resportStr.join(''));

        })
        var str = '<li><a class="download-all" href="'+ data.result.data.allInZipUrl+'">下载全部</a></li>'
        $('.report-show-list').append(str);                            
    })

    //把result用ajax发送给后台
    $('.report-show').show();
})


//点击预览显示预览报表
$('.report-show-list').on('click','a.preview',function(){
    var time = $(this).siblings('span').html().substring(0,10);
    result.timeInterval.from = time;
    result.timeInterval.to = time;
    console.log(result);
    $('.table-report').html('');

    $.getJSON('../mockdata/tableInfo.json',function(data){
        var tableData = data.result[0];
        var header = tableData.header;
        
        var tableHeaderStr = '<thead><tr>'
        $.each(header,function(index,item){
            tableHeaderStr += '<th>'+item+'</th>'
        })
        tableHeaderStr+="</tr></thead><tbody></tbody>"
        $('.table-report').append(tableHeaderStr);

        var tableBody  = tableData.data;
        
        $.each(tableBody,function(index,item){
            var tableBodyStr = '<tr>'
            $.each(item,function(index,innerItem){
                if(index == 0){
                    tableBodyStr += '<th scope="row" >'+innerItem+'</th>'
                }
                else
                {
                    tableBodyStr += '<td>'+innerItem+'</th>'
                }
                
            })
            tableBodyStr+='</tr>';
            $('.table-report tbody').append(tableBodyStr);
        }) 

    })

    // $.getJSON('../mockdata/')
    $('.report-preview').show();
})

// 将会包装事件的 debounce 函数
function debounce(fn, delay) {
  // 维护一个 timer
  let timer = null;
  return function() {
    // 通过 ‘this’ 和 ‘arguments’ 获取函数的作用域和变量
    let context = this;
    let args = arguments;

    clearTimeout(timer);
    timer = setTimeout(function() {
      fn.apply(context, args);
    }, delay);
  }
}

function submit(){

    var searchInfo =  $('.search-input').val();
    $('.search-list').html('');
    if(searchInfo == '') return;

    $.getJSON('../mockdata/search-demo.json',function(data){
        var searchRes = data.result;
        $.each(searchRes,function(index,item){
            var firmName = item.firmName;
           var firmStr = [
                    '<ul name="'+firmName+'">',
                        '<li class="firm">'+firmName+'</li>',
                    '</ul>'
           ]
           $('.search-list').append(firmStr.join(''));
           var modelList = item.modelList;
           $.each(modelList,function(index,item){
                var modelStr = [
                    '<li data-value="'+item.id+'" class="detail">'+item.name+'</li>'
                ]
                $('ul[name="'+firmName+'"]').append(modelStr.join(''));
           })
        })

    })
}

$('.search-input').on('input',debounce(submit,500))
//用户输入的时候需要隔500ms向后台发送一次ajax请求
// $('.search-input').on('input',function(){
//     var searchInfo = $(this).val();
//     // 此处需要将searchinfo的值发到后台，然后渲染list列表
//     console.log(searchInfo);
//     debounce(submit,500)
//     // setTimeout(debounce(),500);

//     function submit(){
//         alert('需要上传');

//     }

// })


//点击list，将选中的按钮放入tab
$('.search-list').on('click','.detail',function(){
    // console.log($(this).html(),$(this).index());
    $(this).parents('.drop-panel').find('input[type=radio]').prop('checked',false);
    $('.selected-tabs .all-cars').parent().remove();
    var value = $(this).data('value');
    var tabStr = '';
    tabStr+='<li><span class="delete-content" data-value='+value+'>'+$(this).html()+'</span><span class="delete-icon">x</span></li>'
    $('.selected-tabs').append(tabStr);
    $('.search-input').val($(this).html());
    $('.search-list').html('');
    
   
})


//点击tab的x按钮删除x
$('.selected-tabs').on('click','li span.delete-icon',function(){
    if($(this).html().indexOf('全部')>-1){
       $(this).parents('.drop-panel').find('.radio input').prop('checked',false)
       $(this).parents('.drop-panel').find('.search-input').val("");
    }
    $(this).parent().remove();
})


//时间控件初始化
 var dateRange1 = new pickerDateRange('date1', {
                    dayRangeMax : 15,
                    isTodayValid : true,
                    startDate : (function(){
                        var now = new Date();
                        now.setDate(now.getDate()-15);
                        var now = now.toLocaleDateString();
                        console.log(now);
                        var nowarr = now.split('/');
                       
                        if(Number(nowarr[1])<10){
                            nowarr[1] = +0+nowarr[1];
                        }
                        if(Number(nowarr[2])<10){
                            nowarr[2] = +0+nowarr[2];
                        }
                        timeInterval.from = nowarr[0]+'-'+nowarr[1]+'-'+nowarr[2]
                        return nowarr[0]+'-'+nowarr[1]+'-'+nowarr[2];
                    })(),
                    endDate:(function(){
                        var now = (new Date()).toLocaleDateString();
                        var nowarr = now.split('/');
                        if(Number(nowarr[1])<10){
                            nowarr[1] = +0+nowarr[1];
                        }
                        if(Number(nowarr[2])<10){
                            nowarr[2] = +0+nowarr[2];
                        }
                        timeInterval.to = nowarr[0]+'-'+nowarr[1]+'-'+nowarr[2];
                        return nowarr[0]+'-'+nowarr[1]+'-'+nowarr[2];
                    })(),
                   
                    // endDate : '2017-7-11',
                    needCompare : false,
                    defaultText : ' 至 ',
                    autoSubmit : true,
                    inputTrigger : 'input_trigger1',
                    theme : 'ta',
                    // stopToday: true,
                    success : function(obj) {
                        timeInterval={};
                        timeInterval.from = obj.startDate;
                        timeInterval.to = obj.endDate
                        console.log(timeInterval);
                    }
                });
</script>

</html>
